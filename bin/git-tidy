#!/usr/bin/env bash

# Default target

targetBranch=master

# Check if we're in a git repo
is_git() {
  git rev-parse --is-inside-work-tree  2> /dev/null
}

# Update target
if [[ ! -z $1 ]]; then
  targetBranch=$1
fi

if [[ $(is_git) ]]; then
  git checkout $targetBranch  &> /dev/null
  git fetch -p  &> /dev/null
  gone=$(git branch -vv | grep ': gone]' | grep -v "\*" | awk '{ print $1; }')
  echo $gone

  for branch in ${gone[@]}; do
    echo "Deleting $branch"
    git branch -D $branch
  done
else
  echo tput setaf 001"Error: Not in a git repository"
fi
