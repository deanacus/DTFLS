#!/usr/bin/env bash

## Amend a commit older than the last commit. Requires an abbreviated commit ID

function main() {
  if [ -z "$@" ]; then
    echo "fatal: no commit id supplied"
    exit 1
  fi
  TARGET=$(git rev-parse "$@")
  git commit --fixup=$TARGET && GIT_EDITOR=true git rebase --interactive --autosquash $TARGET~
}

function is_git_repo() {
  git rev-parse --show-toplevel > /dev/null 2>&1
  result=$?
  if test $result != 0; then
    >&2 echo 'Not a git repo!'
    exit $result
  fi
}

is_git_repo && main "$@"